# Bilibili 视频转文字工具 (VTW) - 需求分析

## 项目概述

**项目名称**: VTW (Video To Word)
**项目目标**: 批量将 Bilibili UP 主视频转换为 Markdown 文档，方便学习记录和知识整理

## 功能需求

### 核心功能

#### 1. 获取视频列表
- 支持输入 B站 UP 主空间 URL，自动获取该 UP 主的所有视频
- 支持输入单个视频 URL
- 支持限制获取视频数量（如最近 10 个、20 个）
- 获取视频元数据：标题、描述、上传时间、时长等

#### 2. 视频转文字（双方案）
**策略：有字幕优先下载字幕，无字幕使用语音识别**

- **方案 A：下载 B站字幕**（优先）
  - 使用 `yt-dlp` 下载 B站的 CC 字幕
  - 解析字幕文件提取文字内容
  - 优点：免费、秒级处理、准确

- **方案 B：语音识别**（备用）
  - 使用 `faster-whisper` 本地运行
  - 模型：base（74MB），准确率 95%+
  - CPU 处理：8-15 分钟/小时视频
  - 内存占用：约 500MB

- **方案 C：大模型校验**（可选）
  - 识别完成后发送给大模型优化
  - 修正错别字、标点、格式
  - 支持模型：DeepSeek、OpenAI 等

- **方案 D：知识模式**（✨ 新增）
  - 使用大模型对转写文本进行结构化处理
  - 自动识别章节结构（3-8 个逻辑章节）
  - 为每个章节生成标题（简洁明了）
  - 为每个章节写 1-2 句小结
  - 生成总体总结（3-5 句话，概括核心知识点）
  - 适用于教学/知识类视频

#### 3. 生成 Markdown 文档
- 每个视频生成独立的 .md 文件
- 文件命名：`视频标题.md`
- 两种处理模式：

**标准模式文档结构**：
  - 视频标题（一级标题）
  - 视频信息（链接、时间、时长、来源、处理模式）
  - 转写正文（不含时间戳）

**知识模式文档结构**（✨ 新增）：
  - 视频标题（一级标题）
  - 内容总结（总体总结，3-5 句话）
  - 视频信息（链接、时间、时长、来源、处理模式）
  - 详细内容（章节化结构）：
    - 章节标题（### N. 章节名）
    - 章节小结（引用格式 `> 小结内容`）
    - 章节正文

- 如果文件名冲突，自动添加序号后缀
- 只输出 .md 格式，不下载视频文件

#### 4. 批量处理
- 支持批量处理多个视频
- 显示处理进度
- 处理失败时记录错误，不影响其他视频
- 可中断和恢复

### 辅助功能

- 命令行界面，易于使用
- 配置文件管理（API Key、输出目录等）
- 错误处理和重试机制
- 进度显示

## 技术需求

### 技术栈

- **编程语言**: Python 3.8+
- **核心依赖**:
  - `yt-dlp`: B站视频信息获取和字幕下载
  - `faster-whisper`: 本地语音识别（备用方案）
  - `requests`: HTTP 请求（获取 UP 主视频列表）
  - `openai`: 大模型 API 调用（可选，用于校验层）

### 性能指标

- **字幕下载**: < 1 秒/视频
- **语音识别**: 8-15 分钟/小时视频（CPU）
- **模型加载**: 首次 3-5 秒，后续 < 1 秒
- **内存占用**:
  - 空闲：< 50MB
  - 处理中：约 500MB（base 模型）

## 非功能需求

### 易用性
- 简单的命令行调用
- 清晰的使用说明
- 友好的错误提示

### 性能
- 支持批量处理，不卡顿
- 合理的请求间隔（避免被反爬）

### 可靠性
- 处理失败不中断整个流程
- 自动重试机制
- 异常情况的处理

## 使用场景

### 场景 1: 学习 UP 主系列课程
```
目标: 某个技术 UP 主的系列教程
需求: 一次性下载整个系列的视频文字版
```

### 场景 2: 整理单个视频
```
目标: 某个重要演讲或分享
需求: 快速获取该视频的文字版本
```

### 场景 3: 批量归档
```
目标: 定期备份某个 UP 主的内容
需求: 获取最近 N 个视频的文字版本
```

## 已确认配置

1. **时间轴格式**: 不包含时间戳
2. **视频下载**: 只获取文字，不下载视频文件
3. **输出格式**: 只输出 .md 格式
4. **模型选择**: faster-whisper base 模型 + 大模型校验层（可选）
5. **配置方式**: 配置文件（config.json）
6. **处理模式**: 标准模式 + 知识模式（✨ 新增）

### 知识模式配置项

- `knowledge_mode.enabled`: 是否启用知识模式
- `knowledge_mode.add_summary_at_top`: 是否在文档开头添加总体总结
- `knowledge_mode.show_chapter_summary`: 是否显示章节小结
- `knowledge_mode.chapter_numbering`: 是否为章节添加编号

## 项目结构

```
vtw/
├── src/                    # 源代码
│   ├── vtw.py             # 主程序
│   ├── config.py          # 配置管理
│   ├── subtitle.py        # 字幕处理模块
│   ├── asr.py             # 语音识别模块
│   ├── verifier.py        # 大模型校验模块 + 知识模式（✨ 新增）
│   └── utils.py           # 工具函数
├── docs/                   # 文档目录（✨ 新增）
│   ├── 需求分析.md       # 需求分析文档
│   └── CHANGELOG.md       # 开发日志
├── output/                # 输出目录（生成的 Markdown 文件）
├── models/                # Whisper 模型缓存目录
├── config.example.json  # 配置模板（✨ 新增）
├── config.json            # 配置文件（不提交到 Git）
├── requirements.txt       # 依赖列表
├── .gitignore            # Git 忽略文件配置
├── README.md             # 使用说明
└── 需求分析.md           # 本文档
```

## 开发计划

1. 需求确认和方案选择（✓ 已完成）
2. 字幕下载功能开发（✓ 已完成）
3. 语音识别功能开发（✓ 已完成）
4. 大模型校验功能开发（✓ 已完成）
5. Markdown 生成功能（✓ 已完成）
6. 批量处理和错误处理（✓ 已完成）
7. 测试和优化（✓ 已完成）
8. 文档完善（✓ 已完成）
9. **知识模式开发**（✓ 已完成 - 2026-01-16）
   - KnowledgeVerifier 类实现
   - 章节结构识别
   - 章节标题和小结生成
   - 总体总结生成
   - Markdown 生成器扩展
10. 项目结构优化（✓ 已完成 - 2026-01-16）
    - 创建 docs/ 目录
    - 添加 config.example.json 模板
    - 更新 .gitignore
